# 9주차. 네트워크 보안

# OSI 7계층
* 네트워크 동작 과정을 설명하는 가장 대표적 모델
* 국제표준화기구 ISO에서 제정
* 개념적 모델 <-> TCP/IP 실제 구현이 된 모델

## 통신 프로토콜
네트워크를 통해 데이터를 주고 받는 과정에 대한 약속
> OSI 7계층 모델은 통신 프로토콜 7개의 세부 프로토콜로 나누어 설명

## 7계층: 응용 계층
* 사용자에게 인터페이스를 제공하는 계층 (UI)
* 메일 (아웃룩), 웹브라우저, FTP 등 서비스
* 프로토콜로는 HTTP, SMTP, FTP, Telnet 등

## 6계층과 5계층
* 6계층: 표현 계층
  * 응용 계층에서 다루는 데이터 형식을 변환하는 계층
  * 암호화, 복호화 혹은 인코딩, 디코딩 등 데이터 형식 변환 수행
    * 이메일 메시지: MIME 포맷으로 인코딩되어 있음 -> 일반 텍스트 포맷으로 변환
* 5계층: 세션 계층
  * 두 개의 응용 프로세스 사이에 통신을 관리하는 계층
    * 전이중: 휴대전화
    * 반이중: 무전기
    * 단방향: 라디오

## 4계층: 전송 계층

#### 역할
* 데이터를 주고 받을 때 데이터의 유실이 없게 보장
* 흐름 제어
  * 양 끝단 전단 받은 데이터의 오류 검출
  * 오류가 있다면 재전송 요청하여 데이터 유실 방지

#### 특징
* 프로토콜은 TCP
* 주소는 포트
* 상위 계층(L5)은 하위 계층(L4)이 하는 일에 관여하지 않는다.
* 5계층의 1개 메시지 -> 2개의 4계층 세그먼트
  * 세그먼트
    * 4계층에서 다루는 데이터 단위
    * 네트워크 전송에 적절한 크기로 쪼갠 것 + 헤더 정보
* 캡슐화: 하위 계층에서 상위 계층의 페이로드에 헤더 정보를 붙이는 것.
  * 페이로드: 상위 게층의 데이터
  * 4계층의 헤더: 흐름 제어를 위한 정보 포함, 데이터 오류 검출하여 만약 오류가 있다고 판단되면 재전송 요청

#### 전송 계층 대표적인 프로토콜
* TCP
  * 흐름제어 O
  * 신뢰성 O
  * 속도 UDP보다 느림
* UDP
  * 흐름제어 X
  * 신뢰성 X
  * TCP보다 빠름
  * 인터넷 실시간 영상 중계 등에 사용

## 3계층: 네트워크 계층
* 라우팅을 처리하는 계층
  * 라우팅: 데이터를 전달할 때 어떤 경로로 데이터를 보낼지 경로 선택하는 것
* 여러 개의 노드가 복잡하게 연결된 네트워크에서 최적의 전달 경로가 정해질 수 있도록 여러 가지 기능 제공
* 프로토콜은 IP
* 주소는 IP주소

#### 특징
* 3계층의 캡슐화
  * 세그먼트에 라우팅과 관련된 헤더 정보 추가
* 패킷의 헤더
  * 최적의 경로 선택 위한 기초 자료 저장
* 기존 구해진 경로 상 한 노드 고장 -> 대체 경로 찾아 전송

## 1계층: 물리 계층
* 단말과 단말 실제 물리적 연결
  * 단말: 네트워크 사이를 연결해주는 관문 역할을 하는 노드 + 네트워크에 참여한 모든 단말
* 광케이블, 구리케이블, 무선네트워크 등으로 연결

## 2계층: 데이터 링크 계층
* 단말 사이의 신뢰성 있는 전송 보장
* 포인트 투 포인트 간 신뢰성 보장
  * 물리 계층에서 발생하는 오류 찾아내고 이를 수정
  * 패리티 검사 기법 등이 사용

#### 특징
* 프레임: 2계층에서 전달하는 데이터의 단위
  * 3계층의 페이로드인 패킷 앞.뒤에 헤더와 테일을 덧 붙인다.
* 프로토콜은 이더넷, ISDN 등
* 주소는 MAC카드

# TCP/IP 프로토콜
* 인터넷을 움직이게 하는 핵심 통신 프로토콜
* OSI 7계층 모델과의 관계
  * 애플리케이션 계층 - 5, 6, 7 계층
  * 전송 - 4계층
  * 네트워크 - 3계층
  * 네트워크 인터페이스 - 1, 2 계층

## IP 프로토콜
* 네트워크 계층에 해당하는 프로토콜
* 라우팅을 담당
* 각 노드의 주소: IP 주소
* 라우팅 테이블: 각 노드 사이 연결 정보를 저장한 테이블
  * 두 연결 사이 비용 저장
  * 전송속도 or 거쳐야 하는 라우터 개수(Hop Count)

## IP 주소
* 네트워크 상 유일 주소
* 네트워크 주소 +  호스트 주소

#### 종류
* IPv4: 일반적으로 IP 주소라고 하면 v4
* IPv6

#### 특징
* IPv4
  * 크기: 32비트(4바이트)
  * 8비트 씩 온점을 찍어 0.0.0.0 ~ 255.255.255.255
  * 42억 개의 주소 할당이 11년 2월 4일 종료 -> 신규할당 불가능
* IPv6
  * 크기: 128비트(16바이트)
  * 16진수 여덟 개 쓰고 각각 쌍점으로 구분
  * IPv4와 호환되지 않는다, 교체 비용이 높아서 적용 더딤
* IP주소의 요청
  * TCP/IP를 관리하는 국제표준기구에 요청
  * IP주소의 네트워크 주소에 해당하는 부분만을 할당 받음
  * 나머지 호스트 주소 범위는 신청자가 자율적 관리

#### 클래스
* A ~ E, 5개
* 일반적 사용: A, B, C
* 특수 목적
  * D: 멀티 캐스팅
  * E: 연구용
* 클래스에 따른 범위
  * A: 0.0.0.1 ~ 127.255.255.255
  * B: 128.0.0.1 ~ 191.255.255.255
  * C: 192.0.0.1 ~ 223.255.255.255
* 클래스 별 주소의 구성
  * A: 네트워크 주소 개수 자체는 적지만 포함하는 호스트 개수 많음
    * 네트워크 개수: 128개
    * 호스트 개수: 256의 3승 개
  * B와 C: 네트워크 주소가 많지만, 포함할 수 있는 호스트 개수 적음
    * C의 네트워크 개수: 2의 5승 x 256의 2승 개
    * C의 호스트 개수: 256개

#### 공인, 사설 IP
* 공인: IANA에 의해 할당받은 IP 주소
* 사설: 사내 네트워크에서만 사용될 수 있는 주소
  * A: 10.0.0.0 ~ 10.255.255.255
  * B: 172.16.0.0 ~ 172.31.255.255
  * C: 192.168.0.0 ~ 192.168.255.255

## TCP 프로토콜
연결 지향적 프로토콜, 통신 시작하면 연결 맺어지고 통신 끝날 때 까지 지속 <-> UDP: 비연결 지향

#### 시작 과정: 3-way Handshaking
1. 송신자: 연결 맺자고 요청하는 SYN(Synchronize, 동기화) 패킷 보냄
1. 수신자: 송신자 요청 승인하는 SYN+ACK(Acknowledge, 수락) 패킷 보냄
1. 송신자: 수신자의 승인 패킷 확인 의미로 ACK 패킷 보냄
> 이러한 3단계 거치면 연결 생성(Established) 상태

#### 실제 메시지 송수신 과정: 2-way 방식
1. 전송: DATA
1. 확인: ACK

###### 흐름 제어
수신자의 ACK 패킷을 송신자가 일정 시간 못 받은 경우
* 송신자는 수신자에게 다시 메시지 전송
* TCP 헤더 정보 이용, 슬라이딩 윈도우 기법으로 처리
  * TCP 헤더 정보: 순서 번호

#### 종료 과정: 4-way
1. 송신자: 수신자에게 FIN(Finish, 종료) 패킷 보냄
1. 수신자: ACK 패킷 보내고 FIN 패킷 또 보낸다.
1. 송신자: 수신자의 FIN 패킷 확인 의미로 ACK 패킷 보냄
> Closed 상태

#### 포트
각 단말기 내 사용되는 주소
> 수신자 시스템 내 어떤 프로그램으로 메시지 올려 보내줄지

###### 포트 사용 예시
* 20, 21 - FTP
* 22 - SSH
* 23 - 텔넷
* 53 - DNS
* 80 - HTTP
* 110 - POP3
* 443 - HTTPS

###### 포트 범위 (2의 16승 - 1)
* 0 ~ 1023 - 잘 알려진 포트
* 1024 ~ 49151 - 등록된 포트
* 49152 ~ 65535 - 동적 포트

## 보안 공격 유형
기준: 직접적 피해가 발생하는지

#### 능동적 공격
* 직접적 피해 O
* 탐지 가능성 쉽다
* 사회공학, 재사용공격, 변조, Dos/DDoS, 세션 하이재킹

#### 수동적 공격
* 직접적 피해 X
* 탐지 어렵다
* 스니핑, 도청

#### 수동적 공격 탐지 중요성
* 수동적 공격을 통해서 보안 취약점 정보 획득 후 능동적 공격 시행하기에

# 무선 네트워크 개요
네트워크 단말 사이의 데이터 전송에 무선 전파를 이용

## 유형
* WPAN: 10미터 이내 근거리 - 블루투스, 지그비
* WLAN: 유선랜 확장, 무선랜 - 100m, 와이파이
* WMAN: 대도시 대상 넓은 지역 - 10km, 와이브로, 와이맥스
* WWAN: 무선 광대역 통신망 - 100km, 이동통신

## 특징
* 감쇠 현상: 모든 방향으로 신호가 펒비기에 신호의 강도는 거리에 따라서 급격히 줄어들어 통신 품질 떨어진다
* 간섭 현상: 신호 중첩되어 전파 교란, 다른 송신자 신호 받을 수도 있다
* 다중 경로 전달 현상: 같은 송신자에게 하나 이상의 신호 받을 수 있다

## 블루투스
* 근거리 무선 네트워크의 한 표준
* 노르웨이 덴마크를 통합한 최초 덴마크의 국왕 별칭에서 유래
* 1994년 스웨덴 통신 장비 제조사인 에릭슨이 최초 개발
  * 초기: 에릭슨, 인텔, IBM, 노키아, 도시바
  * 현재는 9개 회사: MS, 모토로라, 애플, 노르딕 세미컨덕터가 추가
* 적용 범위: 마우스, 키보드 비롯해 휴대전화, 태블릿, 스피커 등 문자정보 및 음성정보 주고 받음

#### 보안 위협 1: 블루 브린팅
* 블루투스 공격 장치의 검색활동
* 블루투스 장치 고유 주소: MAC 주소와 유사하게 앞 3바이트 제조사, 뒤 3바이트 블루투스 장치별 할당
* 블루투스 스캐닝 툴 이용해서 인근 존재하는 블루투스 장치 스캔 (허용된 장치만)
* 대응 방안: 블루투스 검색 허용 꺼두자

#### 보안 위협 2: 블루스나핑
* 취약점 이용해 블루투스 기기의 정보 접근 공격
* 인증 없이 정보 주고 받을 수 있는 OBES Push Profile 기능 악용
* 블루투스 장치로부터 주소록, 달력 등 내용 요청하고 열람하거나 보안적 취약한 임의 파일 접근
* 블루투스 기기가 펌웨어에 버그가 있는 기기라면 공격자는 경우 따라서 디바이스 모든 파일 접근 가능

#### 보안 위협 3: 블루 버깅
* 블루투스 장치를 원격 연결하여 임의 동작 시키는 행동
* 10m 이내 가능
* 전화 걸고, 문자 보내고, 도청도 가능

#### 보안 위협 4: 블루 재킹
* 블루수트 이용해 스팸 메시지를 익명으로 퍼트리는 것
* 가용성을 떨어트리는 것

> 블루투스 이용 안하면 꺼두자. 기기별 완벽한 대책이 없는 경우가 있다.

## 무선랜
* 구성요소
  * 무선 단말기: 무선랜 접속 이용 장비
  * 무선 AP: 유선랜 가장 마지막에 위치하여 무선 단말기에 무선랜 접속을 가능하게 하는 기기

#### 유형
* 2.4GHz 주파수 대역
* 국제표준 IEEE 802.11 주요 기술 스펙 정의
* 현재는 최초 802.11 규약 발전시킨 여러 개의 802.11x 규약 존재

#### 취약점
* 물리적: 외부 노출 형태로 운영, 장비 파손 및 리셋 통한 초기화 등 문제 발생 가능
* 기술적
  * 도청: 외부 다른 무선 클라이언트에서 무선 AP의 존재 여부 파악 & 무선 데이터 수신을 통해 도청 가능
  * 서비스 거부: 무선 AP 장비에 대량 무선 패킷 전송
  * 불법 AP: 불법적으로 무선 AP 설치하여 무선랜 사용자들 접속 유도
  * 비인가 접근-SSID 노출

#### 보안 강화
* 물리적 보안 및 기본 관리자 패스워드 변경
* SSID 브로드캐스팅 금지
* 통신 암호화 및 인증

## WEP
* 무선랜 암호화 기술 중 가장 기본적 방법
* 802.11b 프로토콜 부터 적용
* 암호화 알고리즘: R5C4
  * 키 길이 64비트 or 128비트
  * 공유 암호화 키(40비트 or 104비트)와 임의로 선택되는 24비트 크기의 IV(Initial Vector)값 조합

#### 장단점
* 장점: 구현 간단, 인증 간단
* 단점: 보안성 높지 않다. 크랙 가능

## WPA
* WEP보안 취약점 보완 위해 802.11i 프로토콜부터 제공
* TKIP 알고리즘 사용
  * RC4 기반
  * 48비트 확장된 IV
  * IV의 순차적 증가 규칙 적용
  * 메시지 무결성 체크를 위해 MIC라는 무결성 코드 추가
* 크랙 공격 여전히 있다

## WPA2 / WPA-PSK
WPA 보완 위해 TKIP 대신 CCMP 알고리즘 사용

#### CCMP
RC4 대신 AES 블록 암호화 알고리즘 채택

#### 종류
* 개인: PSK 모드
* 기업: Enterprise 모드

## WPA-EAP
* WPA2에 사용자 인증 부분 추가해서 보안성 강화
* 802.1x / EAP로도 표기
* 사용자가 입력하는 아이디와 패스워드에 의한 사용자 인증
  * 사용자 별 무선랜 연결 세션마다 재사용 불가능한 다른 암호화 키 사용

#### 장단점
* 장점: 뛰어난 보안성
* 단점: RADIUS 서버 필요하고 구조 복잡

#### 인증 과정
* 1) 무선단말기: 무선AP에 연결 요청
* 2) RADIUS 서버: 인증 챌린지 전송
* 3) 무선단말기: 인증 챌린지 값, 계정 패스워드의 해시 값 RADIUS 서버로 전송
* 4) RADIUS 서버: 해시 확인
* 5) RADIUS 서버: 암호화 키 생성
* 6) RADIUS 서버: 암호화키 무선 단말기로 전송
* 7) 무선단말기: 무선AP로 암호화 통신

#### 기타
* 일종의 캡슐화 개념으로 인증 프레임워크 역할