# 14주차. 난수 & 암호 기술과 현실세계

# 난수

# 난수가 사용되는 암호 기술

## 난수의 용도

- 키 생성
  - 대칭 암호나 메시지 인증 코드
- 키 쌍 생성
  - 공개 키 암호나 디지털 서명
- 초기화 벡터(IV) 생성
  - 블록 암호 모드인 CBC, CFB, OFB
- 비표(nonce) 생성
  - 재전송 공격 방지나 블록 암호의 CTR 모드
- 솔트 생성
  - 패스워드를 기초로 한 암호화 (PBE)
- 일회용 패드
  - 패딩에 사용되는 열을 생성

> - 아무리 강한 알고리즘이라도 키가 공격자에게 알려져 버리면 아무 의미가 없다
> - 난수를 사용해서 키를 만들어, 공격자에게 키를 간파당하지 않도록 하는 것
> - 난수를 사용하는 목적: 간파당하지 않도록 하기 위한 것 (예측 불가능성)

# 난수의 성질

## 난수의 성질 분류

- 무작위성
  - 통계적인 편중이 없이 수열이 무작위로 되어 있는 성질
- 예측 불가능성
  - 과거의 수열로부터 다음 수를 예측할 수 없다는 성질
- 재현 불가능성
  - 같은 수열을 재현할 수 없다는 성질. 재현하기 위해서는 수열 그 자체를 보존해야만 하는 성질

> - 재현 불가능성을 가지면 예측 불가능성과 무작위성도 가짐
> - 예측 불가능성을 가지면 무작위성도 가짐

|               | 무작위성 | 예측 불가능성 | 재현 불가능성 | 암호기술 사용 가능여부 |
| ------------- | -------- | ------------- | ------------- | ---------------------- |
| 약한 의사난수 | O        | X             | X             | X                      |
| 강한 의사난수 | O        | O             | X             | O                      |
| 진성 난수     | O        | O             | O             | O                      |

## 무작위성

- 아무렇게로 보이는 성질
- 의사난수열의 통계적인 성질을 조사해서 치우침이 없도록 하는 성질
  - 난수 검정: 무작위성을 조사하는 것
- 암호 기술에 사용하는 난수는 무작위성을 가지고 있는 것만으로는 불충분
  - 약한 의사난수: 무작위성만을 가짐

## 예측 불가능성

- 공격자에게 간파당하지 않는 성질
- 과거에 출력한 의사난수열이 공격자에게 알려져도 다음에 출력하는 의사난수를 공격자는 알아맞힐 수 없다는 성질
- 알고리즘은 공격자에게 알려져 있다고 가정하고 종자를 사용
  - 종자: 공격자에게 비밀
- 강한 의사난수
  - 예측 불가능성을 갖는 의사난수
  - 예측 불가능성을 가지면 당연히 무작위성을 가짐

## 재현 불가능성

- 한 난수열이 주어졌을 때 동일한 수열을 재현할 수 없는 성질
- 재현하기 위해서는 그 난수열 자체를 보존해 두는 것 이외에 방법이 없는 성질
- 소프트웨어만으로는 재현 불가능성을 갖는 난수열 생성 불가
- 소프트웨어는 의사난수열만 생성 가능
  - 소프트웨어가 돌아가는 컴퓨터가 유한의 내부 상태밖에 없기 때문
- 주기
  - 반복이 다시 시작할 때 까지의 수열의 길이
  - 소프트웨어가 생성하는 수열은 언젠가는 반복
  - 주기를 가지는 수열은 재현 불가능하지 않음
- 재현 불가능한 난수 생성
  - 물리현상으로부터 정보 취득
    - 주위 온도나 소리 변화
    - 사용자 마우스 위치 정보
    - 키스트록 입력 시간 간격
    - 방사선 관측기의 출력
    - 다양한 하드웨어로부터 얻어진 정보
- 재현 불가능한 난수
  - 진성 난수
    - 무작위성, 예측불가능성, 재현 불가능성 모두 가짐
  - 동전 던지기로 얻어지는 값

# 의사난수 생성기

- 난수 생성기
  - 하드웨어로 생성
- 의사난수 생성기
  - 소프트웨어로 생성
  - 주기성을 가짐

## 구조

#### 내부 상태

- 의사난수 생성기가 관리 중인 메모리 값
- 의사난수 생성기는 메모리의 값을 기초로 해서 계산을 수행
- 그 계산 결과를 의사난수로서 출력
- 다음 의사난수의 요구에 대비해서 자신의 내부 상태를 변화
- 의사난수 생성 알고리즘
  - 의사난수 계산하는 방법
  - 내부 상태를 변화시키는 방법

#### 종자

- 의사난수 생성기의 내부 상태 초기화에 필요
- 랜덤한 비트열
- 종자는 자신만의 비밀로 유지

# 구체적 의사난수 생성기

## 무작위 방법

- 긴 주기
  - 암호 기술에서 사용하는 난수는 예측 불가능성을 가져야 하므로 주기가 짧아서는 안 됨
- 복잡한 알고리즘보다는 명확한 알고리즘
  - 프로그래머가 자세한 내용을 이해할 수 없는 알고리즘으로 생성한 난수는 예측 불가능성을 갖는지 어떤지 평가를 할 수가 없다

## 선형 합동법

- 일반적으로 가장 많이 사용됨
- 암호 기술에는 사용하면 안 됨
- 현재 의사난수의 값을 A배 하고 C를 더한 다음, M으로 나눈 나머지를 다음 의사난수로 선택

#### 계산 방법

- R0 생성
  - 최초 의사난수 R0 = (A \* 종자 + C) mod M
  - A, C, M은 정수, A와 C는 M보다 작은 수
- R의 n+1 승 생성
  - R의 n+1 승 = (A \* R의 n승 + C) mod M

#### 단점

- 예측 불가능성이 없음
- 선형 합동법을 암호 기술에 사용해서는 절대 안된다
  - 사용 예시
    - C 라이브러리 함수 rand
    - Java의 java.util.Random 클래스

#### 예측 불가능성 테스트

- 공격자가 A = 3, C= 0 , M = 7이라는 값을 알고 있다고 가정
- 공격자가 생성된 의사난수를 1개라도 손에 넣는다면 그 다음에 생성되는 의사난수를 예측하는 것이 가능
- 입수한 의사난수 R을 이용 다음을 계산
  - (A \* R + C) mod M = (3 \* R + 0) mod 7

## 일방향 해시 함수를 사용하는 방법

- 일방향 해시 함수를 사용해서 예측 불가능성을 갖는 의사난수 열을 생성하는 의사난수 생성기를 만들 수 있다
- 일방향 해시 함수의 일방향성이 의사난수 생성기의 예측 불가능성을 보장

#### 잘못 만들어진 의사난수 생성기

- 의사난수 종자를 사용해서 내부 상태를 초기화
- 일방향 해시 함수를 사용해서 카운터의 해시 값 생성
- 그 해시 값을 의사난수로서 출력
- 카운터를 1 증가
- 필요한 만큼의 의사난수가 얻어질 때까지 (2) ~ (4) 반복

> 왜 예측 불가능성이 없나
>
> - 예측 불가능성: 과거의 의사난수 열을 기초로 해서 다음 의사난수를 예측할 수 없다는 성질
> - 마지막에 출력한 의사난수의 해시 값을 취해서 다음 의사난수를 생성하므로
> - 예측 불가능성을 가지려면 일방향 해시 함수의 일방향성을 사용해야

## 암호를 사용하는 방법

- 암호를 사용해서 강한 의사난수를 생성하는 의사난수 생성기를 만들 수 있다
- AES와 같은 대칭 암호나 RSA와 같은 공개 키 암호 중 어느 것을 사용해도 무방
- 암호의 기밀성이 의사난수 생성기의 예측 불가능성을 보장

#### 절차

- 내부 상태(카운터) 초기화
- 키를 사용해 카운터를 암호화
- 그 암호문을 의사난수로서 출력
- 카운터 1 증가
- 필요한 만큼의 의사난수가 얻어질 때까지 (2) ~ (4) 반복

## ANSI X9.17

- 암호 소프트웨어 PGP에서 사용하는 의사난수 생성기
  - ANSI X9.17
  - ANSI X9.31

#### 절차

- 내부 상태 초기화
- 현재 시각 암호화
- 내부 상태와 암호화된 현재시각 XOR
- 절차(3)의 결과를 암호화
- 절차(4)의 결과를 의사난수로서 출력
- 절차(4)의 출력과 암호화된 현재 시각을 XOR
- 절차(6)의 결과를 암호화
- 절차(7)의 결과를 새로운 내부 상태로 세팅
- 절차(2) ~ (8)을 필요한 만큼의 의사난수가 얻어질 때까지 반복

#### 왜 추측을 못할까

- 공격자는 의사난수로부터 역산해서 내부상태와 암호화된 현재시각의 XOR을 간파할 수 없다
  - 이유: 간파하기 위해서는 암호를 해독해야
- 공격자는 지금까지 출력된 의사난수열로부터 의사난수 생성기의 내부 상태를 추측 못한다

## 기타 알고리즘

- 알고리즘 선택 시 주의할점
  - 반드시 이 난수 알고리즘은 암호나 보안 용도로 사용 가능한지 확인
  - 난수로 뛰어나더라도 예측 불가능성을 갖추지 못하면 암호나 보안 용도로는 부적합
    - 메르센 트위스터: 유명하지만 보안용으론 사용 불가
- JAVA: java.security.SecureRandom 써야
- Ruby: SecureRandom 써야

# 의사난수 생성기에 대한 공격

## 종자에 대한 공격

- 종자의 중요성
  - 의사난수의 종자 = 암호의 키에 필적
  - 종자가 공격자에게 노출되면 그 의사난수 생성기가 생성한 모든 의사난수열은 공격자에게 노출
- 종자 선택
  - 재현 불가능성을 갖는 진성 난수 선택

## 랜덤 풀에 대한 공격

- 종자로 사용할 랜덤 비트 열을 사전에 만들어 비축해 놓은 파일
- 암호 소프트웨어가 의사난수 종자가 필요할 경우 필요한 만큼의 랜덤한 비트 열을 꺼내서 사용
- 랜덤 풀 자체는 특별한 정보를 가지지 않지만 유익한 정보 저장을 위해 필요하므로 잘 지켜야 함

---

# 퀴즈

## 주사위

주사위 반복해서 던져서 만드는 수열은 재현 불가능성을 갖는다고 생각하는가?

> 그렇다

## 기초 지식

- 의사난수 종자는 공격자에게 비밀로 해야 -> ( O )
- 선형 합동법은 암호용의 의사난수 생성기로서 이용할 수 있다 -> ( X )
- 무작위성을 가지고 있는 의사난수 생성기라도 반드시 예측 불가능성을 갖는다고만은 할 수 없다 -> ( O )

---

# 암호 기술과 현실세계

# 암호 기술의 정리

## 암호학자의 도구 상자

- 대칭 암호
  - 암호화와 복호화에 같은 키를 이용하는 암호
  - 메시지의 기밀성 지키기 위해 사용
- 공개 키 암호
  - 암호화와 복호화에 서로 다른 키를 이용하는 암호
  - 대칭 암호와 마찬가지로 메시지의 기밀성을 지키기 위해 사용
- 일방향 해시 함수
  - 긴 메시지를 짧은 해시 값으로 변환하는 기술
  - 메시지의 무결성을 확인하기 위해 이용
- 메시지 인증 코드
  - 메시지 무결성 검증, 인증을 행하기 위함
  - 부인 방지에 사용 불가
- 디지털 서명
  - 제3자에 대해서 메시지를 검증하고, 통신 상대의 부인 방지를 행할 수 있는 인증 기술
- 의사난수 생성기
  - 예측 불가능성을 갖는 비트 열을 생성하는 기술
  - 암호나 일방향 해시 함수 등을 사용해서 구성
  - 의사난수 생성기는 키나 초기화 벡터 등을 만들기 위해 사용

## 암호 기술의 종합 응용

## 암호와 인증

- 암호만을 생각하기 쉽지만 암호학자의 도구 상자를 보면 인증도 중요

## 암호 기술의 프레임워크화

- 프레임워크
  - 내부에 사용하고 있는 요소 기술을 교환할 수 있는 구조
  - 아무리 안전하다고 생각되는 요소 기술이라도 어느 때 약점이 발견될지 모름
  - 전체가 프레임워크라는 형태로 되어있으면 사용하고 있는 개개의 기술에 약점이 발견되었다고 하더라도 고정난 부품을 교환하는 것처럼 그 기술마누 교체할 수 있음

## 암호기술은 압축 기술

- 암호학자의 도구 상자 안 기술의 공통점: 모든 기술이 일종의 압축 기술
- 기밀성의 압축: 긴 평문을 지키는 대신 짧은 키를 지킨다
- 무결성의 압축: 긴 평문 대신에 짧은 해시 값 조사
- 인증의 압축: 긴 메시지 대신 짧은 인증자 조사
- 예측 불가능성의 압축: 의사난수열의 예측 불가능성을 이끌어내기 위한 출발점으로서 난수의 종자를 사용

|                  | 압축 전     | 압축 후        | 특징                 |
| ---------------- | ----------- | -------------- | -------------------- |
| 대칭 암호        | 평문        | 키             | 기밀성의 압축        |
| 공개 키 암호     | 평문        | 키             | 기밀성의 압축        |
| 일방향 해시 함수 | 메시지      | 해시 값        | 무결성의 압축        |
| 메시지 인증 코드 | 메시지      | 인증자(MAC 값) | 인증의 압축          |
| 디지털 서명      | 메시지      | 인증자(서명)   | 인증의 압축          |
| 의사난수 생성기  | 의사난수 열 | 종자           | 예측 불가능성의 압축 |

# 완전한 암호 기술을 꿈꾸며

## 양자 암호

- 양자론을 이용한 암호 기술
- 베넷과 브라사르에 의해 1980년대에 제안
- 암호라고 이름이 붙어 있지만 엄밀하게는 암호를 직접 구성하는 것이 아니라 도청이 불가능한 통신을 구성하는 기술
- 광자의 양자론적인 성질을 이용한 통신 방법

#### 특징

- 광자가 진동하는 방향을 정확하게 측정하는 것이 원리적으로 불가능하다는 사실
  - 도청 내용을 부정확하게 할 수 있다고 하는 결과
- 측정하는 것으로 광자의 상태가 변화된다는 사실
  - 도청 시 사실을 알 수 있다

## 양자 컴퓨터

- 양자 암호가 암호학자의 궁극적 도구라면 양자 컴퓨터는 암호해독자의 궁극적 도구
- 양자 컴퓨너틑 양자론 이용 기술로 영국 데이비드 도이치에 의해 제안
- 실용화는 미해결

## 어느 쪽이 먼저 실용화될까

- 양자 암호가 양자 컴퓨터보다도 먼저 실용화되면 양자 암호를 사용해서 일회용 패드를 구축하고 완전한 암호 기술 탄생
- 양자 암호보다도 양자 컴퓨터가 먼저 탄생하면 현재 암호 기술에 의한 암호문 모두 해독

# 기타

- 이론은 완전하더라도 현실은 불완전하다
- 방어는 완전하지 않으면 안되지만 공격은 어느 한 곳만 깨면 된다
- PGP 암호화 메일 공격
  - 사회공학적 공격
- SSL/TLS로 암호화된 신용카드 번호에 대해
