# 12주차. 디지털 서명 (2) & 인증서

# RSA에 의한 디지털 서명

## RSA에 의한 서명 작성

- 서명 = (메시지)D mod N
- D와 N은 서명자의 개인 키

## RSA에 의한 서명 검증

- 서명으로부터 얻어진 메시지 = (서명)E mod N
- E와 N은 서명자의 공개 키

## 자세한 RSA 서명

- 공개 키: E = 5, N = 323
- 개인 키: D = 29, N = 323
- N이 323이므로 메시지는 0 ~ 322 범위의 정수에서 고른다
- 여기서는 123이라는 메시지에 서명을 해보자

#### 서명 작성

- 메시지D mod N = 123의 29승 mod 323 = 157
- 서명은 157
- 수신자에게 전달할 것
  - (메시지, 서명) = (123, 157)

#### 서명 검증

- (메시지, 서명) = (123, 157) 수신
- 공개 키(E, N) = (5, 323)을 사용해서 서명으로부터 얻어진 메시지를 계산
- 서명E mod N = 157의 5승 mod 323 = 123
- 이 메시지 123은 분명히 송신자가 보낸 메시지 123과 일치
- 서명 검증에 성공

# 기타 디지털 서명

## ElGamal 방식

- Taher ElGamal에 의한 공개 키 알고리즘으로 mod N으로 이산 대수를 구하는 것이 곤란하다는 것을 이용
- ElGamal 방식은 공개 키 암호와 디지털 서명에 이용
- 암호 소프트웨어 GnuPG에서도 알고리즘의 하나로 사용

## DSA

- 디지털 서명 알고리즘의 일종으로 NIST가 1991년에 제정한 디지털 서명 규격
- DSA는 Schnorr의 알고리즘과 ElGamal 방식의 변종으로 디지털 서명에만 이용

## ECDSA

타원 곡선 암호(ECC)를 사용한 디지털 서명 알고리즘

## Rabin 방식

- M. O. Rabin에 의한 공개 키 알고리즘으로 mod N으로 평방근을 구하는 것이 곤란하다는 것을 이용
- Rabin 방식은 공개 키 암호와 디지털 서명에 이용

# 디지털 서명에 대한 공격

## 중간자 공격

- 디지털 서명에도 위협이 되는 공격
- 중간자 공격을 막으려면 입수한 공개 키가 정확한 상대의 것인지 아닌지를 확인 필요
- 핑거프린트
  - 공개 키를 취급하는 소프트웨어에서 공개 키의 해시 값을 표시하는 수단
  - 이 해시 값을 핑거프린트라 한다

## 일방향 해시 함수에 대한 공격

- 디지털 서명에서 사용하는 일방향 해시 함수는 충돌 내성을 가져야만 한다
- 만약 충돌내성이 없으면 디지털 서명을 한 해시 값과 같은 해시 값을 갖는 다른 메시지를 만들 수 있다

## 디지털 서명을 사용한 공개 키 암호 공격

- 밥은 맬로리한테 온 메일을 읽고 첨부 데이터를 보니 확실히 랜덤한 데이터인 것 같다고 여긴다 (하지만 실은 이것은 앨리스가 밥의 공개 키로 암호화한 암호문이다)
- 밥은 순수한 마음으로 첨부 데이터에 서명을 한다

#### 맬로리의 목적 달성

- 서명 = (첨부데이터)D mod N (RSA의 서명 작성)
- = (암호문)D mod N (첨부 데이터는 실은 암호문이기 때문에)
- = 메시지 (복호화 처리가 행하여졌기 때문에)

> 의미를 모르는 메시지는 절대로 디지털 서명을 하지 않아야

## 잠재적 위조

- 개인 키가 없는 공격자가 의미가 있는 메시지를 만들고 그에 대한 바른 디지털 서명을 만들 수 있다면 그 디지털 서명 알고리즘은 안전하지 않음
- 의미가 없는 메시지(예, 랜덤한 비트 열)라고 하더라도, 만약 올바른 디지털 서명을 만들 수 있다면 (즉, 검증을 통과할 수 있는 디지털 서명이 된다면), 그것은 디지털 서명 알고리즘에 대한 위협

#### RSA에서의 잠재적 위조

- 메시지를 RSA로 복호화하는 디지털 서명 알고리즘에서는 잠재적 위조가 가능
  - 랜덤한 비트 열 S를 RSA의 공개 키로 암호화한 것을 M이라고 하면, S가 M의 바른 디지털 서명이 되어 버리기 때문 (이것은 앞절에서 설명한 것의 역이다)
  - 공개 키는 공격자도 구할 수 있으므로 디지털 서명의 잠재적 위조가 가능
- 대처법
  - RSA-PSS
    - RSA를 개량함
    - 메시지에 대해서가 아니라 메시지의 해시 값에 대해 서명하는 방법
    - 해시 값의 계산 시에는 메시지에 솔트를 더해 더욱 안전성 향상

## 기타 공격

- 공개 키 암호에 대한 공격의 대부분은 디지털 서명에 대한 공격으로서도 사용 가능
- 개인 키에 대한 전사 공격
- RSA의 N을 소인수분해하는 공격

# 기타 기술과 비교

## 메시지 인증 코드와 디지털 서명

- 메시지 인증 코드와 디지털 서명은 매우 유사한 기술
- 두 가지 모두 무결성 확인을 통해 인증이 가능

|              | 대칭 암호        | 공개 키 암호                             |
| ------------ | ---------------- | ---------------------------------------- |
| 송신자       | 공유 키로 암호화 | 공개 키로 암호화                         |
| 수신자       | 공유 키로 복호화 | 개인 키로 복호화                         |
| 키 배송 문제 | 발생한다         | 발생하지만, 공개 키의 인증이 별도로 필요 |
| 기밀성       | O                | O                                        |

|              | 메시지 인증 코드        | 디지털 서명                              |
| ------------ | ----------------------- | ---------------------------------------- |
| 송신자       | 공유 키로 MAC 값을 계산 | 개인 키로 서명을 작성                    |
| 수신자       | 공유 키로 MAC 값을 계산 | 공개 키로 서명을 검증                    |
| 키 배송 문제 | 발생한다                | 발생하지만, 공개 키의 인증이 별도로 필요 |
| 무결성       | O                       | O                                        |
| 인증         | O(통신 상대에 대해서만) | O(제 3자에 대해서도)                     |
| 부인방지     | X                       | O                                        |

## 하이브리드 암호 시스템과 해시 값에 대한 디지털 서명

- 대칭 암호의 키는 기밀성의 핵심
- 일방향 해시 함수의 해시 값은 무결성의 핵심

# 디지털 서명으로 해결할 수 없는 문제

- 조작되어 있지 않은 공개 키를 거짓 행세 하고 있지 않은 송신자로부터 받을 필요가 있다
- 인증서
  - 바른 공개 키를 입수하기 위해 고안된 것이 공개 키 기반(Public Key Infrastructure)
  - 공개 키 암호 및 디지털 서명의 기술을 사회적인 기반(기반 구조)으로 만들어 가는 것

## 기술적인 방법만으로는 해결할 수 없는 문제

- 의문: 공개된 장소에서 구한 앨리스의 공개 키는 믿을만한 것인가
- 해결책: 제 3자가 자신의 개인 키로 앨리스의 공개 키를 서명해서 밥에게 전달한다
  - 의문: 제 3자는 믿을 수 있는가
  - 해결책: 송신자 앨리스와 수신자의 밥은 둘이 믿을 수 있는 제3자를 선정한다

# 퀴즈

## 공개 키와 개인 키의 역할

- 앨리스가 메시지의 디지털 서명을 작성하려면 앨리스와 공개 키와 개인 키 중 어느 쪽이 필요한가? 개인 키
- 앨리스의 서명을 검증하기 위해서는 앨리스의 공개 키와 개인 키 중 어느 쪽이 필요한가? 공개 키

## 디지털 서명의 기초 지식

- 디지털 서명을 검증하기 위해서는 서명한 사람의 개인 키가 필요하다 (X) -> 공개키 (교재 고치기)
- RSA는 디지털 서명 알고리즘을 사용할 수 있다 (O)
- 디지털 서명을 사용하면 메시지의 기밀성을 지킬 수 있기 때문에 도청당할 염려가 없다 (X) -> 기밀성을 지키는 것이 아니라 부인 방지

---

# 인증서

## 인증서란 무엇인가

- 공개 키 인증서
- 이름이나 소속, 메일 주소 등의 개인 정보
- 당사자의 공개 키가 기재됨
- 인증기관의 개인 키로 디지털 서명

## 인증서를 사용하는 시나리오

- 밥이 키 쌍을 작성한다
- 밥은 인증기관 트렌트에 자신의 공개 키를 등록한다
- 인증기관 트렌트는 밥의 공개 키에 자신의 개인 키로 디지털 서명을 해서 인증서를 작성한다
- 앨리스는 인증기관 트렌트의 디지털 서명이 되어 있는 밥의 공개 키(인증서)를 입수한다
- 앨리스는 인증기관 트렌트의 공개 키를 사용해서 디지털 서명을 검증하고 밥의 공개 키가 맞다는 것을 확인한다
- 앨리스는 밥의 공개 키로 메시지를 암호화해서 밥에게 송신한다
- 밥은 암호문을 자신의 개인 키로 복호화해서 앨리스의 메시지를 읽는다

# 공인 인증서 (인증서 만들기)

## 공인 인증서 종류

- 범용 공인인증서
  - 모든 분야에서 이용
  - 인터넷뱅킹, 온라인증권, 전자상거래, 전자정부 민원서비스, 4대 사회보험, 국세청 홈택스, 전자세금계산서, 전자입찰/조달, 온라인교육, 예비군 등 다양한 분야 활용
  - 소정의 수수료
- 용도제한 공인인증서
  - 은행 및 보험, 신용카드 업무, 정부 민원 업무 등 특정 분야에서만 이용
  - 해당 기관이 고객에게만 발급
  - 무료

## 인증서 표준 규격

- X.509
  - 공개 키 인증서와 인증 알고리즘 표준 공개 키 기반(PKI)의 ITU-T의 표준
  - 가장 널리 사용
  - ITU나 ISO에서 규정한 규격
  - 인증서 생성.교환을 수행할 때 사용
  - 많은 애플리케이션에서 지원

# 공개 키 기반 구조(PKI)

## 공개 키 기반

- 공개 키를 효과적으로 운용하기 위해 정한 많은 규격이나 선택 사양의 총칭
  - PKCS
    - RSA사가 정하고 있는 규격의 집합
  - RFC 중에서도 PKI에 관련된 문서
    - 인터넷의 선택사양을 정함
  - X.509
  - API 사양서

## PKI 구성 요소

- 이용자 - PKI를 이용하는 사람 (개체)
  - PKI를 사용해서 자신의 공개 키를 등록하고 싶어하는 사람
  - 등록되어 있는 공개 키를 사용하고 싶어하는 사람
  - 하는 일
    - 키 쌍을 작성(인증기관이 작성하는 경우도 있다)
    - 인증기관에 공개 키를 등록
    - 인증기관으로부터 인증서를 발행 받음
    - 필요할 경우 인증기관에 신청해서 등록한 공개 키를 무효로 한다
    - 수신한 암호문을 복호화한다
    - 메시지에 디지털 서명을 한다
  - 공개 키 사용자가 하는 일
    - 메시지를 암호화해서 수신자에게 송신한다
    - 디지털 서명을 검증한다
- 인증기관 - 인증서를 발행하는 사람
  - 인증서의 관리를 행하는 기관
  - 키 쌍을 작성한다(이용자가 작성하는 경우도 있다)
  - 공개 키 등록 때 본인을 인증한다
  - 인증서를 작성해서 발행한다
  - 인증서를 폐지한다
  - 등록 기관
    - 인증기관의 일 중 공개키의 등록과 본인에 대한 인증을 대행하는 기관
- 저장소 - 인증서를 보관하고 있는 DB
  - 인증서를 보존
  - PKI 이용자가 인증서를 입수할 수 있도록 한 데이터베이스
  - 인증서 디렉토리

## 공인 인증기관

- 미래창조과학부 산하 민간 최상위 인증기관인 한국인터넷진흥원이 있음
- 전자서명법 제 4조의 규정에 의해 지정된 공인인증기관은 5개가 있음
- 개인 또는 기업 등의 요청에 따라 공인인증서를 발급
  - 철저한 심사 젗라를 통해 발급
  - 법적 효력과 안전성 보장

## 역할

- 키 쌍의 생성
- 인증서 등록
- 인증서 폐지와 CRL

#### 키 쌍의 생성

- PKI의 이용자가 생성하기
- 인증기관이 생성하기
  - 개인 키를 이용자에게 보내는 추가 업무
  - 방법은 RFC 7292 규격으로 정함

#### 인증서 등록

- 이용자는 인증기관에 인증서 작성을 의뢰
  - 규격은 RFC 2986 등으로 정함
- 운용 규격에 근거해서 이용자를 인증하고, 인증서를 생성
  - 인증 기관의 개인 키를 사용해서 디지털 서명을 함
  - 인증서 형식을 X.509로 정함

#### 인증서 폐지와 CRL

- 폐지해야 할 경우
  - 개인 키 분실 혹은 도난
- 인증서 폐지 목록(CRL)을 작성
- 인증기관 최신 CRL 조사해서 그 인증서 유효성 확인 필요

## 계층 구조를 갖는 인증서

- 루트 CA: 최상위 인증기관
- 셀프 서명: 자기 자신의 공개 키에 대해서 자신의 개인 키로 서명하는 디지털 서명

## 다양한 PKI

- 누구나 인증기관이 될 수 있고 실제로 세계에는 무수히 많은 인증기관이 존재
- 사내 이용방법
  - 인증기관의 계층을 회사의 조직 계층의 적용
  - 부서별로 PKI 운영하고 상호 인증
- 우리나라 PKI
  - 한국인터넷진흥원 전자서명인증관리센터에서 관리
  - 인증기관의 계층이나, 운용 규약, 공개 키의 등록.인증서 발행 등을 규정

# 인증서에 대한 공격

## 공개 키 등록 이전 공격

- 인증기관이 디지털 서명을 수행하기 이전에 적극적 공격자 맬로리가 공개 키를 자신의 것과 살짝 바꿔치기
- 인증기관은 밥의 정보와 맬로리의 공개 키의 조합에 대해 디지털 서명을 하게 된다

## 닮은 사람을 등록하는 공격

- 오인하기 쉬운 사용자 정보를 사용
  - Name = Bob -> Name = BOB
- 이 공개 키 이름은 BOB로 되어 있지만 맬로리의 공개 키
- 맬로리는 밥의 행세를 하며 Name = BOB으로 되어 있는 인증서를 앨리스에게 보낸다

## 인증 기관의 개인 키를 훔쳐내는 방법

인증기관의 개인 키가 도난당했다면 인증기관은 자신의 키가 도난당했다는 것을 CRL을 사용해서 이용자에게 통지

## 공격자 자신이 인증 기관이 되는 공격

- 맬로리 자신이 인증기관이 된다
- 인증기관이 된 맬로니는 자신의 공개 키라도 이것은 밥의 공개 키이다라고 주장하는 인증서를 자유롭게 발행
- 인증기관을 신뢰할 수 없으면 인증서가 아무리 바르더라도 그 공개키를 사용해서는 안된다

## CRL의 허점을 찌르는 공격 (1)

- 공격자 맬로리는 CRL이 도착하기 전에 빠른 공격을 시도
- 방어 방법
  - 공개 키가 무효가 되면 가능한 한 빨리 인증기관에 전한다 (밥)
  - CRL은 신속하게 발행한다 (트렌트)
  - CRL은 정확히 갱신한다 (앨리스)
  - 공개 키를 이용하기 전에는 공개 키가 무효되지 않았나를 재확인한다 (앨리스)

## CRL의 허점을 찌르는 공격 (2)

- 밥이 앨리스로부터 돈을 뜯어낼 계획 수립
- 밥은 가명을 써서 계좌 X-5897 개설
- 앨리스에게 송금요청을 하고 자신의 서명을 붙임
- 트렌트에게 개인 키가 도난 당했다고 보고
- 앨리스에게 CRL이 도착하기 전 앨리스가 해당 금액을 계좌 X-5897로 송금을 했다면
- 밥은 예금을 인출한다
- 앨리스가 나중에 CRL을 받고 밥에게 항의
- 밥은 자신의 개인 키가 도난 당했다고 주장하고 돈을 착복

## Superfish

- 레노보 사 중대한 사건
  - 컴퓨터에 프리인스톨 되어있던 슈퍼피시라는 애드웨어가 보안 상 문제 일으킴
  - 통신을 가로채 개인 정보를 수집하여 사용자의 인터넷 이용 맞춤 광고를 내보내는 소프트웨어
  - 루트 인증서를 인스톨하여 웹사이트와 웹브라우저 사이에 들어간 후 방문한 웹사이트 인증서를 바꿔치기 하여 웹브라우저에 제시
  - 전형적인 중간자 공격으로 통신 갈취

# 인증서에 대한 Q&A

## 인증서의 필요성

- 의문: 인증기관의 인증서를 사용해서 공개 키를 입수하는 것과 공개 키만을 받는 것과는 같은 것이 아닌가?
- 답
  - 신뢰할 수 없는 경로로 공개 키를 입수하는 경우 중간자 공격이 가능해진다
  - 인증기관으로부터 인증서를 입수하면 중간자 공격의 가능성을 줄일 수 있다

#### 필요성

- 신뢰할 수 있는 공개 키를 입수할 수 있다면 인증기관은 불필요하다
- 신뢰할 수 있는 인증기관의 공개 키를 가지고 있고 인증기관의 본인 확인을 신뢰한다면 그 인증기관이 발행한 인증서에 의해 입수한 공개 키는 신용할 수 있다

## 독자적인 인증 방법을 사용하는 것이 안전한 것이 아닌가

- 의문: 인증서 형식이든 PKI든 공개되어 있는 기술을 사용 하는 것에 불안을 느낀다. 공개되어 있는 기술을 사용한 다는 것은 공격자에게 공격을 위한 정보를 제공하는 것 이 된다고 생각한다. 그것보다는 사내에서 독자적으로 개발한 비밀 인증 방법을 사용하는 편이 안전하지 않을까?
- 답
  - 아니다
  - 비밀 인증 방법을 독자 개발하는 것은 감추는 것에 의한 보안이라는 전형적인 잘못

## 인증기관을 어떻게 신뢰할 것인가

- 의문: 인증기관의 기능은 대강 이해를 했지만, 결국 맴도 는 것 같은 느낌이 든다. 공개 키를 신뢰하기 위해서는 인 증서를 발행한 인증기관을 신뢰해야 하는데, 그렇다면 인 증기관은 어떻게 신뢰하는 것일까?
- 답
  - 이 의문은 정당
  - 이 의문은 신뢰가 어떻게 형성되는가 하는 본질적 문제와 관계되어 있다 (은행에 돈을 맡기는 것 처럼)

# 퀴즈

## 인증기관은 대단히 바쁘다?

디지털 서명이 되어있는 메일을 받을 때마다 인증기관 트렌트에게 디지털 서명의 검증을 받지 않으면 안되니까 바쁠까?

> 잘못됨. 개개의 메일에 있는 디지털 서명을 검증하는 것은 인증기관이 아니라 공개 키의 이용자이기 때문에. 인증기관이라는 것은 인증서 발행기관이라고 부르는 편이 맞다

## 인증서의 기초 지식

- 인증서는 이용자의 공개 키를 인증기관이 암호화한 것 (X) -> 디지털 서명
- 인증서에 포함되어 있는 공개 키가 바른지 어떤지를 확인하기 위해서는 인증기관의 공개 키가 필요하다 (O)
- 전 세계에서 발행되고 있는 인증서는 모두 인증기관의 계층을 따라가면 유일한 루트 CA까지 도달한다 (X) -> 인증기관이 여러 개
- 자신의 개인 키가 누설되었다는 것을 안 이용자는 공개 키를 등록하고 있는 인증기관에 서둘러 연락할 필요가 있다 (O)
- 이용자는 인증기관으로부터 정기적으로 CRL을 입수할 필요가 있다 (O)

# 추가

## 공인인증서 폐지

- 공인 인증서 사라짐
- 지난 5월 20일 국회에서 공인인증서와 사설인증서의 구별을 없애는 내용의 전자서명법 개정안 통과

## 앞으로 인증은

- 기존에 사용하던 공인인증서는 계속 사용 가능
- 공인으로 취급되던 5개 기관이 발급한 인증서와 민간에서 발급한 인증서가 경쟁을 시작하는 것
- 이미 시장에서는 카카오, 네이버, 이통3사가 개발한 인증서가 경쟁
- 공인인증서도 편리해짐 (갱신기간 1년 -> 3년으로 연장)
